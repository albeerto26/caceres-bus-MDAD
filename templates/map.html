<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/main-style.css') }}">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBo6E0nwsf0ijiCQZJBsq8Rs7Ptt4Na6l4&callback=initMap"></script>
</head>
<body>
<div id="flight-time-box" style='display:none'>{{flight_time}}</div>
<div id="menu-box">
    <div id="menu-title">
        Search Fly
    </div>
    <form method="POST">
        <div style="font-weight: 800;">Departure Date:</div>
        <div><input type="date" name="date"></p></div>
        <div style="font-weight: 800;">Origin:</div>
        <div>
            <select name="origin">
                {% for airport in airports %}
                <option value="{{airport.id}}">{{airport.name}}</option>
                {% endfor %}
            </select>
        </div>
        <div style="font-weight: 800;">Target:</div>
        <div>
            <div>
                <select name="target">
                    {% for airport in airports %}
                    <option value="{{airport.id}}">{{airport.name}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div><input id="search-button" type="submit" name="Search"></div>
    </form>
</div>
<div id='map'></div>
<script>
    function initMap() {
        var paloalto = {lat: 37.4419, lng: -122.1419};
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 15,
            center: paloalto
        });
        flightPlan = {{data | safe}}
        if (flightPlan != null && flightPlan.length > 0) {
            drawFlightPlan(map, flightPlan);
            $('#flight-time-box').fadeIn(400).delay(3000);
        }
    }
    function drawFlightPlan(map, flightPlan) {
        //populate the list with the points for Polyline
        flightPlanList = [];
        function populateFlighPlanList(latLng) {
            console.log("a√±adiendo punto de la ruta...")
            console.log(latLng);
            var latLngFormatted = {lat: latLng.lat, lng: latLng.long}
            flightPlanList.push(latLngFormatted)
        }

        flightPlan.forEach(populateFlighPlanList)

        //draw Polyline
        var flightPath = new google.maps.Polyline({
            path: flightPlanList,
            geodesic: true,
            strokeColor: '#FF0000',
            strokeOpacity: 1.0,
            strokeWeight: 2
        });
        flightPath.setMap(map);

        //draw markers at origin and target points
        var originPoint = new google.maps.Marker({
            position: flightPlanList[0],
            title: 'Origin'
        });
        var targetPoint = new google.maps.Marker({
            position: flightPlanList[flightPlanList.length - 1],
            title: 'Target'
        });
        originPoint.setMap(map);
        targetPoint.setMap(map);

        //center map to center of flight path
        var center = flightPlanList[parseInt(flightPlanList.length / 2)]
        map.setCenter(center)
        map.setZoom(5)
    }
</script>
</body>
</html>